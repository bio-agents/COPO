<!DOCTYPE html>
<meta charset="utf-8">
<html lang="en">
{% load compress %}
{% load staticfiles %}
{% load html_tags %}
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}COPO - Collaborative Open Plant Omics{% endblock %}</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="{% static 'copo/css/bootstrap/bootstrap.css' %}">
    <link rel="stylesheet" href="{% static 'copo/css/bootstrap/bootstrap-dialog.css' %}">
    <link rel="stylesheet" href="{% static 'copo/css/bootstrap/dropdowns-enhancement.css' %}">
    <link rel="stylesheet" href="{% static 'copo/css/bootstrap/bootstrap-theme.css' %}">
    <link rel="stylesheet" href="{% static 'copo/bootstrap_switch/css/bootstrap-switch.css' %}">
    <link rel="stylesheet" href="{% static 'copo/fuelux/css/fuelux.css' %}">
    <link rel="stylesheet" href="{% static 'copo/rangeslider/rangeslider.css' %}">
    <link rel="stylesheet" href="{% static 'copo/css/copo/style.css' %}">
    <link rel="stylesheet" href="{% static 'copo/css/copo/menu.css' %}">
    <link rel="stylesheet" href="{% static 'copo/autocomplete_js/autocomplete.css' %}">


    <link rel="shortcut icon" href="{% static 'copo/img/COPO_icon.png' %}"/>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="{% static 'copo/css/font-awesome/css/font-awesome.min.css' %}">
    <link rel="stylesheet" href="{% static 'copo/css/awesome/css/awesome-bootstrap-checkbox.css' %}">

    <!-- Selectize Components -->
    <link rel="stylesheet" href="{% static 'copo/css/selectize/selectize.css' %}">

    <!-- Google Fonts -->
    <link href='http://fonts.googleapis.com/css?family=Quattrocento+Sans' rel='stylesheet' type='text/css'>
    <!-- Additional stylesheets -->
    {#    <link rel="stylesheet" href="{% static 'copo/css/copo/smart_table.css' %}">#}
    {% block stylesheet_block %}{% endblock %}


    <!--[if lt IE 9]>
    <script src="{% static 'copo/js/jquery-1.11.1.min.js' %}"></script>
    <![endif]-->
    <!--[if gte IE 9]><!-->
    <script src="{% static 'copo/js/jquery-2.1.4.min.js' %}"></script>
    <script src="{% static 'copo/js/jquery-ui.min.js' %}"></script>
    <!--<![endif]-->

    <script src="{% static 'copo/js/jquery.cookie.js' %}"></script>
    <script src="{% static 'copo/js/serialize_form_json.js' %}"></script>
    <script src="{% static 'copo/js/bootstrap.js' %}"></script>
    <script src="{% static 'copo/js/bootstrap-dialog.js' %}"></script>
    <script src="{% static 'copo/js/dropdowns-enhancement.js' %}"></script>
    <script src="{% static 'copo/js/selectize.js' %}"></script>
    <script src="{% static 'copo/bootstrap_switch/js/bootstrap-switch.js' %}"></script>
    <script src="{% static 'copo/fuelux/js/fuelux.js' %}"></script>
    <script src="{% static 'copo/validator1000hz/validator.min.js' %}"></script>
    <script src="{% static 'copo/rangeslider/rangeslider.min.js' %}"></script>

    <script src="{% static 'copo/js/base.js' %}"></script>

    <!-- Additional javascripts -->
    {% block js_block %}{% endblock %}

    <link rel="stylesheet" href="{% static 'copo/css/jquery/jquery-ui.min.css' %}">
    <!-- Date picker components -->
    <link rel="stylesheet" href="{% static 'copo/css/datepicker/jquery.datepick.css' %}">
    <script src="{% static 'copo/js/datepicker/jquery.plugin.js' %}"></script>
    <script src="{% static 'copo/js/datepicker/jquery.datepick.js' %}"></script>

    <!-- EasyUI components -->
    <link rel="stylesheet" href="{% static 'copo/css/easyui/themes/default/easyui.css' %}">
    <link rel="stylesheet" href="{% static 'copo/css/easyui/themes/icon.css' %}">
    <script src="{% static 'copo/js/easyui/jquery.easyui.min.js' %}"></script>

    <!-- DataTables components -->
    <link rel="stylesheet" href="{% static 'copo/datatables/css/jquery.dataTables.css' %}">
    <link rel="stylesheet" href="{% static 'copo/datatables/css/dataTables.bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'copo/datatables/css/select.dataTables.min.css' %}">
    <link rel="stylesheet" href="{% static 'copo/datatables/css/buttons.dataTables.min.css' %}">
    <link rel="stylesheet" href="{% static 'copo/datatables/css/buttons.bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'copo/search_highlight/dataTables.searchHighlight.css' %}">

    <script src="{% static 'copo/datatables/js/jquery.dataTables.min.js' %}"></script>
    <script src="{% static 'copo/datatables/js/dataTables.bootstrap.min.js' %}"></script>
    <script src="{% static 'copo/datatables/js/dataTables.select.min.js' %}"></script>
    <script src="{% static 'copo/datatables/js/dataTables.buttons.min.js' %}"></script>
    <script src="{% static 'copo/datatables/js/buttons.bootstrap.min.js' %}"></script>
    <script src="{% static 'copo/autocomplete_js/autocomplete.js' %}"></script>
    <script src="{% static 'copo/search_highlight/dataTables.searchHighlight.min.js' %}"></script>
    <script src="{% static 'copo/search_highlight/jquery.highlight.js' %}"></script>

    <script src="{% static 'copo/autocomplete_js/autocomplete.js' %}"></script>
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    {% compress css %}
        <link rel="stylesheet" type="text/scss" href="{% static 'copo/css/copo/colors/sass.scss' %}"/>
    {% endcompress %}

    <script>

        $(document).ready(function () {
            //global search box
            $("#global_search_form").submit(function (event) {
                event.preventDefault();

                $(this).find("input:text").each(function () {
                    console.log($(this).val()); //search term
                    $(this).val('');
                });
            });//end global search

            //suspended toggle
            $(document).on('click', '.dropdown-menu', function (e) {
                if ($(this).hasClass('keep-open-on-click')) {
                    e.stopPropagation();
                }
            });
            //end suspended toggle


        });


        AutoComplete({
            post: do_post
        });


        function do_post(result, response, custParams) {
            response = JSON.parse(response);
            var properties = Object.getOwnPropertyNames(response);
            //Try parse like JSON data

            var empty,
                    length = response.length,
                    li = domCreate("li"),
                    ul = domCreate("ul");
            //Reverse result if limit parameter is custom
            if (custParams.limit < 0) {
                properties.reverse();
            }


            for (var item in response.highlighting) {
                try {
                    li.innerHTML = response.highlighting[item].label_autosuggest[0];

                    $(li).attr("data-autocomplete-value", response.highlighting[item].label_autosuggest[0].replace('<b>', '').replace('</b>', '') + ' - ' + item);

                    ul.appendChild(li);
                    li = domCreate("li");
                }
                catch (err) {
                    console.log(err)
                }
            }
            if (result.hasChildNodes()) {
                result.childNodes[0].remove();
            }

            result.appendChild(ul);
        }


        function do_email_form() {
            var component = "";
            var copoFormsURL = "/copo/copo_forms/";

            var message = "An email address is required for your user account!";
            var errMessage = "Please enter a valid email address!";
            var $content = '<div>';
            $content += '<div style="margin-bottom: 10px;">' + message + '</div>';
            $content += '<input id="emaddres" type="text" class="form-control" placeholder="Enter email address">';
            $content += '</div>';

            var dialog = new BootstrapDialog({
                type: BootstrapDialog.TYPE_WARNING,
                title: "Add Email Address",
                message: $content,
                closable: false,
                onhide: function (dialogRef) {
                    var re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
                    var emaddres = dialogRef.getModalBody().find('#emaddres').val();
                    emaddres = $.trim(emaddres);
                    if (emaddres == '' || !re.test(emaddres)) {
                        alert(errMessage);
                        return false;
                    } else {
                        //save to db
                        var csrftoken = $.cookie('csrftoken');

                        $.ajax({
                            url: copoFormsURL,
                            type: "POST",
                            headers: {'X-CSRFToken': csrftoken},
                            data: {
                                'task': 'user_email',
                                'component': component,
                                'user_email': emaddres
                            },
                            success: function (data) {
                                ;
                            },
                            error: function () {
                                alert("Couldn't add email!");
                            }
                        });

                    }
                },
                buttons: [{
                    label: 'Submit',
                    cssClass: 'btn-custom3',
                    action: function (dialogRef) {
                        dialogRef.close();
                    }
                }]
            });

            dialog.realize();
            dialog.getModalFooter().removeClass('modal-footer');
            dialog.getModalFooter().css({"padding": "15px", "text-align": "right"});

            dialog.open();

        } //end of do_email_form


    </script>

</head>

<body>

<!-- hidden fields -->
<input type="hidden" id="elastic_search_ajax" value="{% url 'copo:ajax_search_ontology' ontology_names='999' %}"/>

<nav id="copo-global-nav" class="navbar navbar-default navbar-fixed-top" style="background: rgba(38, 38, 38, 0.95);">
    <div class="container-fluid">
        <div class="navbar-header">
            <a class="navbar-brand" href="{% url 'copo:index' %}">
                <img style="height: 50px; margin-top: -15px;"
                     src="{% static "copo/img/logo7-white-leaves-trans.png" %}"/>
            </a>
            <button type='button' class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="sr-only">Toggle Navigation</span>
            </button>
        </div>

        <ul class="nav navbar-nav navbar-right collapse navbar-collapse">
            <li>
                <form id="global_search_form" class="navbar-form" role="search">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search COPO">
                        <div class="input-group-btn">
                            <button class="btn btn-custom" type="submit"><i class="fa fa-search fa-fw"></i>
                            </button>
                        </div>
                    </div>
                </form>
            </li>
            <li class="dropdown">
                <a href="#" class="dropdown-toggle " data-toggle="dropdown" role="button" aria-haspopup="true"
                   aria-expanded="false">

                    <i style="padding-right: 5px;" class="fa fa-cloud-upload" aria-hidden="true"></i>
                    Status

                    <span class="caret"></span>
                </a>

                <ul class="dropdown-menu keep-open-on-click"
                    style="min-width:320px !important; overflow: auto;">
                    <li>
                        <div id="global-status-message">
                            <div style="padding:10px; color: rgba(85, 85, 85, 1);">
                                No status message.
                            </div>
                        </div>
                    </li>
                </ul>
            </li>
            <li class="dropdown">
                <a href="#" class="dropdown-toggle " data-toggle="dropdown" role="button" aria-haspopup="true"
                   aria-expanded="false">
                    {% if user.is_authenticated %}
                        <i style="padding-right: 5px;" class="fa fa-user" aria-hidden="true"></i>
                        {{ user }}
                        {% if not user.email %}
                            <script type="text/javascript">
                                do_email_form();
                            </script>
                        {% endif %}
                    {% else %}
                        <i style="padding-right: 5px;" class="fa fa-sign-in" aria-hidden="true"></i>
                        Login
                    {% endif %}
                    <span class="caret"></span>
                </a>

                <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">
                    {% if user.is_authenticated %}

                                <li>
                                    <a href="{% url 'copo:view_orcid_profile' %}" role="menuitem" tabindex="-1">
                                        <div class="custom-nav-items">
                                            <i class="fa fa-eye" aria-hidden="true"></i>
                                            <span class="icon_text">Orcid Profile</span>
                                        </div>
                                    </a>
                                </li>

                                <li>
                                    <a href="{% url 'copo:view_oauth_tokens' %}" role="menuitem" tabindex="-1">
                                        <div class="custom-nav-items">
                                            <i class="fa fa-cogs" aria-hidden="true"></i>
                                            <span class="icon_text">View Tokens</span>
                                        </div>
                                    </a>
                                </li>

                                <li role="presentation"><a role="menuitem" tabindex="-1"
                                                           href="/copo/logout/">
                                    <div class="custom-nav-items">
                                        <i class="fa fa-sign-out" aria-hidden="true"></i>
                                        <span class="icon_text">Logout</span>
                                    </div>
                                </a>
                                </li>
                            {% else %}
                                <li>
                                    <a href="/copo/login/" role="menuitem" tabindex="-1">
                                        <div class="custom-nav-items">
                                            <i class="fa fa-sign-in" aria-hidden="true"></i>
                                            <span class="icon_text">Login</span>
                                        </div>
                                    </a>
                                </li>
                            {% endif %}
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</nav>


{% block page_banner %}
    <!-- fiter tag to check if there are partial submissions -->
    {% comment %}
        {{ partial_submissions|partial_submission_banner }}
    {% endcomment %}
{% endblock %}

{% block content_area %}
    {#    this block will be inherited by one of two page types i.e., single column (base_1col.html), two columns (base_2col.html - for fixed side navbar) #}
    {#    include either of the two templates (inheriting this base template) in your working page and not the base.html directly. #}
{% endblock content_area %}


</body>
</html>
